<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>我的名片</title>
    <link rel="stylesheet" type="text/css" href="__STATIC__/distribut/css/main.css"/>
    <link rel="stylesheet" href="__STATIC__/css/style.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/categoryList.css"/>
    <script src="__STATIC__/js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__STATIC__/js/mobile-util.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__STATIC__/js/layer.js"  type="text/javascript" ></script>
    <script src="__STATIC__/js/swipeSlide.min.js" type="text/javascript" charset="utf-8"></script>
    <link rel="shortcut icon" type="image/x-icon" href="{$tpshop_config.shop_info_store_ico|default='/public/static/images/logo/storeico_default.png'}" media="screen"/>
    <script src="__STATIC__/js/bootstrap.min.js"  type="text/javascript" ></script>
    <script src="__STATIC__/js/cropper.min.js"  type="text/javascript" ></script>
    <script src="__STATIC__/js/cut_main.js"  type="text/javascript" ></script>
    <link rel="stylesheet" href="__STATIC__/css/cut_main.css">
    <link rel="stylesheet" href="__STATIC__/css/cropper.min.css">
    <link rel="stylesheet" href="__STATIC__/css/bootstrap.min.css">
    <link rel="stylesheet" href="__STATIC__/css/qr_code.css">
</head>
<include file="public/header_nav" title="我的二维码" href="javascript:history.go (-1)"/>
<body class="code_bg">
<if condition="$bg_img != '' && session('user') neq ''">
    <div class="smallPhoto" style="display: block;">
        <a href="javascript:;" class="filePhoto">
            <label for="avatarInput" style="display: inline">
                <img src="__STATIC__/images/header_photo.png"  style="width: .9rem;height: .72rem;position: static;margin-top: -.1rem"  alt=""
                     id="avatarImg">
            </label>
        </a>
    </div>
</if>


<div class="banner ban1" style="margin-top: 1.8rem">
    <div class="mslide" id="slideTpshop" >
        <ul>
            <!--已上传照片-->
            <if condition="$bg_img != ''">
                <li>
                    <div>
                        <div class="user_code">
                            <img  style="height: 6rem;width: 6rem;border-radius: .2rem" src="/index.php?m=Home&c=Index&a=qr_code&data={$ShareLink}&head_pic={$head_pic}&back_img={$back_img}<if condition='$qr_mode eq 1'></if>"/>
                        </div>
                        <div class="nickname">
                            <p>我是"{$user.nickname}"</p>
                        </div>

                        <div class="uploadPic">
                            <if condition="$bg_img == ''">
                                <label for="avatarInput" style="display: inline">
                                    <a href="javascript:;" class="file">
                                        <img src="__STATIC__/images/photo.png"  style="width: .9rem;height: .72rem;position: static;margin-top: -.1rem" alt="">上传照片
                                        <input type="file" accept="image/jpg,image/jpeg,image/png,image/gif" class="cameraInput" name="cameraInput"  onchange="handleFiles(this)">
                                    </a>
                                </label>
                            </if>
                        </div>
                        <div class="bgTop">
                            <img src="{$bg_img|default='http://cdn.cfo2o.com/public/upload/other/pic_bg.png'}" class="changePic" style="height: 16rem;pointer-events: none" alt="">
                        </div>
                        <div class="bgBottom">
                            <img src="http://cdn.cfo2o.com/public/upload/other/code_font.png" style="height: 1.7rem;pointer-events: none;width: 7.5rem;" alt="">
                        </div>
                    </div>
                </li>
            </if>

            <li>
                <div>
                    <div class="user_code">
                        <img  style="height: 6rem;width: 6rem;border-radius: .2rem" src="/index.php?m=Home&c=Index&a=qr_code&data={$ShareLink}&head_pic={$head_pic}&back_img={$back_img}<if condition='$qr_mode eq 1'></if>"/>
                    </div>
                    <div class="nickname">
                        <p>我是"{$user.nickname}"</p>
                    </div>
                    <div class="bgTop">
                        <img src="http://cdn.cfo2o.com/public/upload/other/code_bg.png/s01" style="height: 16rem;pointer-events: none" alt="">
                    </div>
                    <div class="bgBottom">
                        <img src="http://cdn.cfo2o.com/public/upload/other/code_font.png" style="height: 1.7rem;pointer-events: none;width: 7.5rem;" alt="">
                    </div>
                </div>
            </li>
            <!--未上传-->
            <if condition="$bg_img == ''">
                <li>
                    <div>
                        <div class="user_code">
                            <img  style="height: 6rem;width: 6rem;border-radius: .2rem" src="/index.php?m=Home&c=Index&a=qr_code&data={$ShareLink}&head_pic={$head_pic}&back_img={$back_img}<if condition='$qr_mode eq 1'></if>"/>
                        </div>
                        <div class="nickname">
                            <p>我是"{$user.nickname}"</p>
                        </div>

                        <div class="uploadPic" style="">
                            <if condition="$bg_img == ''">
                                <label for="avatarInput"  class="file">
                                    <!--<a href="javascript:;" class="file">-->
                                        <img src="__STATIC__/images/photo.png"  style="width: .9rem;height: .72rem;position: static;margin-top: -.1rem" alt="">上传照片
                                    <!--</a>-->
                                </label>

                            </if>

                        </div>
                        <div class="bgTop">
                            <img src="{$bg_img|default='http://cdn.cfo2o.com/public/upload/other/pic_bg.png'}" class="changePic" style="height: 16rem;pointer-events: none" alt="">
                        </div>
                        <div class="bgBottom">
                            <img src="http://cdn.cfo2o.com/public/upload/other/code_font.png" style="height: 1.7rem;pointer-events: none;width: 7.5rem;" alt="">
                        </div>
                    </div>
                </li>
            </if>

        </ul>
    </div>
</div>

<!--插件 开始  html-->
<div  id="crop-avatar">
    <!-- Cropping modal -->
    <div class="modal fade in " style="display: none" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg" style="position: static;">
            <div class="modal-content" style="position: static;">
                <form class="avatar-form" action="{:U('distribut/upload_img',array('user_id'=>$Request.param.user_id))}" enctype="multipart/form-data" method="post">
                    <!--<div class="modal-header">-->
                        <!--<button class="close" data-dismiss="modal" type="button">&times;</button>-->
                        <!--<h4 class="modal-title" id="avatar-modal-label">Change Avatar</h4>-->
                    <!--</div>-->
                    <div class="modal-body" style="position: static;">
                        <div class="avatar-body">

                            <!-- Upload image and data -->
                            <div class="avatar-upload" style="visibility: hidden">
                                <input class="avatar-src" name="avatar_src" type="hidden">
                                <input class="avatar-data" name="avatar_data" type="hidden">
                                <label for="avatarInput" style="display: inline"></label>
                                <input class="avatar-input" id="avatarInput" name="avatar_file" type="file" onchange="handleFiles()" >
                            </div>

                            <!-- Crop and preview  裁剪框 -->

                            <!--裁剪展示-->
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="avatar-wrapper" style="height: 13rem;width: 100%"></div>
                                </div>
                                <!--裁剪展示-->
                                <!--<div class="col-md-3">-->
                                <!--<div class="avatar-preview preview-lg"></div>-->
                                <!--<div class="avatar-preview preview-md"></div>-->
                                <!--<div class="avatar-preview preview-sm"></div>-->
                                <!--</div>-->
                            </div>

                            <div class="row avatar-btns" style="margin-top: 2rem;">
                                <div class="col-xs-4">
                                    <button class="btn  btn-block " onclick="cancel()" style="background: transparent;text-align: left;margin-left: .8rem">取消</button>
                                </div>
                                <div class="col-xs-4">
                                    <!--<button class="btn  btn-block "   title="Rotate -90 degrees" style="background: transparent;">-->
                                        <img src="__STATIC__/images/xz.png" style="width: .8rem;height: .8rem;margin-left: 2.6rem;margin-top: .2rem;" data-method="rotate" data-option="-90"  alt="">
                                    <!--</button>-->
                                </div>
                                <div class="col-xs-4">
                                    <button class="btn  btn-block avatar-save" type="submit" style="opacity: .95;background: transparent;text-align: left;margin-left: 2.4rem" >确认</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="modal-footer">
                      <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                    </div> -->
                </form>
            </div>
        </div>
    </div>
    <!-- /.modal -->
</div>
<!--插件 结束  html-->
<script>
    var ShareImgUrl = "https://{$_SERVER[HTTP_HOST]}__STATIC__/images/logo_share.png"; //分享图标
    var ShareTitle = "送你100元优惠大礼包，快来免费领取吧"; //分享标题
    var ShareDesc = "加入尚美缤纷，千款正品好货供你选购~"; //分享描述
    // var ShareLink = "http://{$_SERVER[HTTP_HOST]}/index.php/mobile/Goods/goodsTopic/topic_id/{$topic_id}"; //分享链接
</script>
<include file="public/wx_share"/>
<script>
    // $().cropper({'autoCropArea':1,'background':false});
    $('.row').cropper('dragCrop',false);

    //轮播
    $(function(){
        $('#slideTpshop').swipeSlide({
            continuousScroll:true,
            speed : 3000,
            autoSwipe:false,
            transitionType : 'cubic-bezier(0.22, 0.69, 0.72, 0.88)',
            firstCallback : function(i,sum,me){
                me.find('.dot').children().first().addClass('cur');
            },
            callback : function(i,sum,me){
                me.find('.dot').children().eq(i).addClass('cur').siblings().removeClass('cur');
                if (i == 0) {
                    $(".smallPhoto").show();
                } else {
                    $(".smallPhoto").hide();
                }
            }
        });
        //圆点
        var ed = $('.mslide ul li').length - 2;
        $('.mslide').append("<div class=" + "dot" + "></div>");
        for(var i = 0; i<ed ;i++){
            $('.mslide .dot').append("<span></span>");
        };
        $('.mslide .dot span:first').addClass('cur');
        var wid = - ($('.mslide .dot').width() / 2);
        $('.mslide .dot').css('position','absolute').css('left','50%').css('margin-left',wid);
    });
    function qrModeBtn()
    {
        var qr_mode = Number(!$('.change-btn').hasClass('xmove'));
        location.href = "{:url('Distribut/qr_code')}?user_id={$user.user_id}&qr_mode="+qr_mode;
    }

    //显示上传照片
    function handleFiles(input) {
        $("#avatar-modal").show();

        // $("form[name=upload]").submit();

        // if (input.files && input.files[0]) {
        //     var reader = new FileReader();
        //     reader.onload = function (e) {
        //         console.log(e.target.result);
        //         $('.dd').css('display', 'block');
        //         $('.newSrc').attr('src', e.target.result);
        //
        //     };
        //     reader.readAsDataURL(input.files[0]);
        // }
    }
    // 点击上传给input绑定事件
    // function updatePic() {
    //     $('.cameraInput').click();
    //     event.preventDefault();
    //     return false;
    // }
     // 裁剪取消按钮
    function cancel() {
        $('#avatar-modal').hide();
        event.preventDefault();

    }
    // window.onload = function() {
    //     var div1 = document.getElementById("div1");
    //     div1.onmousedown = function (ev) {
    //         var oevent = ev || event;
    //
    //         var distanceX = oevent.clientX - div1.offsetLeft;
    //         var distanceY = oevent.clientY - div1.offsetTop;
    //
    //         document.onmousemove = function (ev) {
    //             var oevent = ev || event;
    //             div1.style.left = oevent.clientX - distanceX + 'px';
    //             div1.style.top = oevent.clientY - distanceY + 'px';
    //         };
    //         document.onmouseup = function () {
    //             document.onmousemove = null;
    //             document.onmouseup = null;
    //         };
    //
    //     };
    // }
</script>
</body>
</html>
