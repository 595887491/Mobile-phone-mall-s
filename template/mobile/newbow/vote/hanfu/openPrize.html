<!DOCTYPE>
<html>
<head>
    <title>寻找最美汉服</title>
    <script src="__STATIC__/js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__STATIC__/js/rem.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__STATIC__/js/layer.js"  type="text/javascript" ></script>
    <!--<link rel="shortcut icon" type="image/x-icon" href="{$tpshop_config.shop_info_store_ico|default='/public/static/images/logo/storeico_default.png'}" media="screen"/>-->
    <link rel="stylesheet" href="__STATIC__/css/new/team_base.css">
    <link rel="stylesheet" href="__STATIC__/css/new/openPrize.css">
    <!--<link rel="stylesheet" href="__STATIC__/css/new/getFree.css">-->
    <!--<link rel="stylesheet" href="__STATIC__/css/new/voteMainInfo.css">-->
</head>
<body class="">
  <section class="top">
      <div class="content"  <if condition="$is_login == 1 && $is_join == 1">style="bottom: 1rem;"</if>>
          <!--未登录-->
          <if condition="$is_login == 0">
              <p>你还未登录，登录查看是否获奖</p>
              <a href="{:U('Mobile/User/login')}">
                  <img src="__STATIC__/images/new/goLogin.png" alt="" class="staus-img">
              </a>
              <else/>
              <!--逛逛好货1-->
              <if condition="$is_join == 1 && $is_win ==0">
                  <p>很遗憾，你未获得奖品</p>
                  <a href="{:U('Mobile/Index/index')}">
                    <img src="__STATIC__/images/new/goShopping.png" alt="" class="staus-img">
                  </a>
              </if>
              <!--逛逛好货2-->
              <if condition="$is_join ==0">
                  <p>活动已结束</p>
                  <a href="{:U('Mobile/Index/index')}">
                      <img src="__STATIC__/images/new/goShopping.png" alt=""  class="staus-img">
                  </a>
              </if>
              <!--填写收货地址-->
              <if condition="$is_join == 1 && $is_win ==1 && $order['is_order'] !=1">
                  <p>恭喜你获得{$prizeName}</p>
                  <a href="{:U('Mobile/User/add_address',array('goods_id'=>$prizeGoods,'source'=>'vote'))}">
                    <img src="__STATIC__/images/new/writeAddress.png" alt="" class="staus-img">
                  </a>
              </if>

              <!--查看奖品订单-->
              <if condition="$is_join == 1 && $is_win ==1 && $order['is_order'] ==1">
                  <p>恭喜你获得{$prizeName}</p>
                  <a href="{:U('Mobile/Order/order_detail',array('id'=>$order['order_id']))}">
                     <img src="__STATIC__/images/new/checkOrder.png" alt="" class="staus-img">
                  </a>
              </if>
          </if>

          <if condition="$is_login == 1 && $is_join == 1">
          <p style="font-size: .26rem; color: #A66508;font-weight: bold;
text-align: center;margin-top: .2rem;">我的排名：{$user_rank}</p>
          </if>
      </div>
      <div class="nav">
          <ul>
              <li class="checked">获奖用户</li>
              <li>全部排行</li>
          </ul>
         <img src="__STATIC__/images/new/home_tab_bg.png" alt="">
     </div>
  </section>
  <section class="prize_wrap">
      <!--一等奖-->
      <section class="prize first_prize">
      <div class="">
          <div class="prize-inside">
              <a href="{:U('Mobile/goods/goodsInfo',array('id'=>$prize_user['onePrizeInfo']['goods_id']))}">
                  <div class="prize-inside-top" style="background: url('__STATIC__/images/new/first_prize.png')no-repeat;background-size: 100% 100%;">
                      <p class="remark">{$prize_user['onePrizeInfo']['goods_intro']}</p>
                      <img src="__STATIC__/images/new/prize_next.png" alt="" class="fr">
                  </div>
              </a>
              <foreach name="$prize_user['one']" item="v">
                  <a href="{:U('Mobile/vote/voteMainInfo',array('found_id'=>$v['found_id']))}">
                      <div class="prize-people">
                          <img src="{$v['my_photo']}?x-oss-process=style/s340x340" alt="" class="fl">
                          <div class="msg fr">
                             <p class="title">
                                 <span>{$v['found_id']}号</span>
                                 <span class="fr">{$v['vote_number']}票</span>
                             </p>
                              <p class="nickName">{$v['title']}</p>
                              <p class="details">{$v['slogan']}</p>
                          </div>
                      </div>
                  </a>
              </foreach>
          </div>
      </div>
       <p class=""  style="left: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
       <p  style="right: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
   </section>
      <!--二等奖-->
      <section class="prize seconde_prize" style="margin-top: .1rem;">
          <div class="">
              <div class="prize-inside">
                  <a href="{:U('Mobile/goods/goodsInfo',array('id'=>$prize_user['twoPrizeInfo']['goods_id']))}">
                      <div class="prize-inside-top" style="background: url('__STATIC__/images/new/seconde_prize.png')no-repeat;background-size: 100% 100%;">
                          <p class="remark">{$prize_user['twoPrizeInfo']['goods_intro']}</p>
                          <img src="__STATIC__/images/new/prize_next.png" alt="" class="fr">
                      </div>
                  </a>
                  <foreach name="$prize_user['two']" item="v">
                      <a href="{:U('Mobile/vote/voteMainInfo',array('found_id'=>$v['found_id']))}">
                          <div class="prize-people">
                              <img src="{$v['my_photo']}?x-oss-process=style/s340x340" alt="" class="fl">
                              <div class="msg fr">
                                  <p class="title">
                                      <span>{$v['found_id']}号</span>
                                      <span class="fr">{$v['vote_number']}票</span>
                                  </p>
                                  <p class="nickName">{$v['title']}</p>
                                  <p class="details">{$v['slogan']}</p>
                              </div>
                          </div>
                      </a>
                  </foreach>
              </div>
          </div>
          <p class=""  style="left: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
          <p  style="right: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
      </section>
      <!--三等奖-->
      <section class="prize seconde_prize" style="margin-top: .1rem;">
          <div class="">
              <div class="prize-inside">
                  <a href="{:U('Mobile/goods/goodsInfo',array('id'=>$prize_user['threePrizeInfo']['goods_id']))}">
                      <div class="prize-inside-top" style="background: url('__STATIC__/images/new/third_prize.png')no-repeat;background-size: 100% 100%;">
                          <p class="remark">{$prize_user['threePrizeInfo']['goods_intro']}</p>
                          <img src="__STATIC__/images/new/prize_next.png" alt="" class="fr">
                      </div>
                  </a>
                  <foreach name="$prize_user['three']" item="v">
                      <a href="{:U('Mobile/vote/voteMainInfo',array('found_id'=>$v['found_id']))}">
                      <div class="prize-people">
                          <img src="{$v['my_photo']}?x-oss-process=style/s340x340" alt="" class="fl">
                          <div class="msg fr">
                              <p class="title">
                                  <span>{$v['found_id']}号</span>
                                  <span class="fr">{$v['vote_number']}票</span>
                              </p>
                              <p class="nickName">{$v['title']}</p>
                              <p class="details">{$v['slogan']}</p>
                          </div>
                      </div>
                  </a>
                  </foreach>
              </div>
          </div>
          <p class=""  style="left: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
          <p  style="right: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
      </section>
      <!--入围奖-->
      <section class="prize seconde_prize" style="margin-top: .1rem;">
          <div class="">
              <div class="prize-inside">
                  <a href="{:U('Mobile/goods/goodsInfo',array('id'=>$prize_user['fourPrizeInfo']['goods_id']))}">
                      <div class="prize-inside-top" style="background: url('__STATIC__/images/new/finalist.png')no-repeat;background-size: 100% 100%;">
                          <p class="remark">{$prize_user['fourPrizeInfo']['goods_intro']}</p>
                          <img src="__STATIC__/images/new/prize_next.png" alt="" class="fr">
                      </div>
                  </a>
                  <foreach name="$prize_user['four']" item="v">
                      <a href="{:U('Mobile/vote/voteMainInfo',array('found_id'=>$v['found_id']))}">
                          <div class="prize-people">
                              <img src="{$v['my_photo']}?x-oss-process=style/s340x340" alt="" class="fl">
                              <div class="msg fr">
                                  <p class="title">
                                      <span>{$v['found_id']}号</span>
                                      <span class="fr">{$v['vote_number']}票</span>
                                  </p>
                                  <p class="nickName">{$v['title']}</p>
                                  <p class="details">{$v['slogan']}</p>
                              </div>
                          </div>
                      </a>
                  </foreach>
              </div>
          </div>
          <p class=""  style="left: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
          <p  style="right: .06rem;"><img src="__STATIC__/images/new/border-bottom.png" alt=""></p>
      </section>
  </section>

  <section class="ranking_wrap" style="display: none;">
      <!--<foreach name="$ranking" item="v" key="k">-->
          <!--<div class="ranking-list">-->
              <!--<div class="ranking-list-img">-->
                  <!--<img class="lazy" data-original="{$v['my_photo']}?x-oss-process=style/s340x340" alt="">-->
              <!--</div>-->
              <!--<p class="title">-->
                  <!--<span>{$v['title']}</span>-->
                  <!--<span class="fr">{$v['vote_number']}票</span>-->
              <!--</p>-->
              <!--<p class="details">-->
                  <!--{$v['slogan']}-->
              <!--</p>-->

              <!--<p class="ranking">第{$k+1}名</p>-->
              <!--<p class="ranking-num">{$v['found_id']}号</p>-->
          <!--</div>-->
      <!--</foreach>-->
  </section>
</body>
<!--<script type="text/javascript" src="__STATIC__/js/sourch_submit.js"></script>-->
<script type="text/javascript" src="__STATIC__/js/jquery.lazyload.js"></script>
<script>
    // 判断是否有缓存 数据 猜你喜欢  返回到浏览位置
    var page=0;
    // var voteMainInfoPage = sessionStorage.getItem("voteMainInfoPage");
    var ajax_pending = false;//进行中
    var has_more_data = true;//还有数据
    var datahtml ='';
    // if(voteMainInfoPage != '') {
    //     page = voteMainInfoPage;
    //     ajax_sourch_submit();
    // }else{
    //     page =0;
    // }

    $('.nav ul li').each(function (i,v) {
        $(v).on('click', function () {
            var index = $(this).index();
            $('.nav ul li').removeClass('checked');
            $(this).addClass('checked');
            if (index == 0) {
                $('.prize_wrap').show();
                $('.ranking_wrap').hide();
                $('.nomore').hide();
            }
            else {
                $('.prize_wrap').hide();
                $('.ranking_wrap').show();
                $('.nomore').show();
                ajax_sourch_submit();
                //滚动加载更多
                $(window).scroll(
                    function() {
                        var scrollTop = parseInt($(this).scrollTop());
                        var scrollHeight = parseInt($(document).height());
                        var windowHeight = parseInt($(this).height());
                        if (scrollTop + windowHeight >= scrollHeight-50) {
                            ajax_sourch_submit();//调用加载更多
                        }
                    }
                );
            }
        });
    });
    /**
     * ajax加载更多数据
     */
    function ajax_sourch_submit() {
        if (ajax_pending || has_more_data == false) return;
        ajax_pending = true;
        ++page;
        $.ajax({
            type : "GET",
            url:"/index.php/Mobile/vote/openPrize&p="+page,
            success: function(data) {
                ajax_pending = false;
                if ($.trim(data) != '') {
                    datahtml+= data;
                    $('.ranking_wrap').html(datahtml);
                    // datahtml += data;
                    // sessionStorage.setItem("voteMainInfoPage",page);
                    // sessionStorage.setItem("voteMainInfoData", datahtml);
                    //加载更多时 懒加载配置
                    $("img.lazy").lazyload({effect: "fadeIn"});
                    $("img.lazy").lazyload({ threshold :180});
                } else {
                    has_more_data = false;
                    $('body').append('<p class="nomore" style="width: 100%;line-height: .8rem;font-size: .26rem;color: #999;text-align: center;">没有更多了</p>');
                }
            }
        });
    }


    // 判断是否有缓存 数据 猜你喜欢  返回到浏览位置
    // $(function () {
    //     var a = sessionStorage.getItem("voteMainInfoData");
    //     if(a != '') {
    //         $('.guessList').html(a);
    //     }
    // });
    // var page = sessionStorage.getItem("userPage")

    // 懒加载  相关配置
    $(function() {
        $("img.lazy").lazyload({effect: "fadeIn"});
    });
    $("img.lazy").lazyload({ threshold :180});
    $("img.lazy").lazyload({
        placeholder : "/template/mobile/newbow/static/images/aa.png", //用图片提前占位
        // placeholder,值为某一图片路径.此图片用来占据将要加载的图片的位置,待图片加载时,占位图则会隐藏
        effect: "fadeIn", // 载入使用何种效果
        // effect(特效),值有show(直接显示),fadeIn(淡入),slideDown(下拉)等,常用fadeIn
        threshold: 150, // 提前开始加载
        // threshold,值为数字,代表页面高度.如设置为200,表示滚动条在离目标位置还有200的高度时就开始加载图片,可以做到不让用户察觉
        event: 'click',  // 事件触发时才加载
        // event,值有click(点击),mouseover(鼠标划过),sporty(运动的),foobar(…).可以实现鼠标莫过或点击图片才开始加载,后两个值未测试…
        container: $(".ranking_wrap"),  // 对某容器中的图片实现效果
        // container,值为某容器.lazyload默认在拉动浏览器滚动条时生效,这个参数可以让你在拉动某DIV的滚动条时依次加载其中的图片
        failurelimit : 10 // 图片排序混乱时
        // failurelimit,值为数字.lazyload默认在找到第一张不在可见区域里的图片时则不再继续加载,但当HTML容器混乱的时候可能出现可见区域内图片并没加载出来的情况,failurelimit意在加载N张可见区域外的图片,以避免出现这个问题.
    });
    // 判断ios 和  安卓  兼容样式问题
    $(function () {
        var u = navigator.userAgent;
        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
        var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        if(isAndroid || !isiOS){  //安卓

        }else{  //苹果
            // $('.guessItem .guessCom').css("height",".7rem")
        }
    });
</script>
<!-- 微信浏览器 调用微信 分享js-->
<script>
    var ShareImgUrl = "{$info['my_photo']}?x-oss-process=style/s340x340"; //分享图标
    var ShareTitle ="我在参加“寻找最美汉服”投票活动，拜托帮忙投一票" ; //分享标题
    var ShareDesc = "能否获得全球广受欢迎的Dior香水，就看你啦！帮忙投票>>"; //分享描述
    var team_url = window.location.href;
    var ShareLink = team_url; //分享描述
</script>
<include file="public/wx_share"/>
</html>